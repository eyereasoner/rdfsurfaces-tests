@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix string: <http://www.w3.org/2000/10/swap/string#>.
@prefix math: <http://www.w3.org/2000/10/swap/math#>.
@prefix crypto: <http://www.w3.org/2000/10/swap/crypto#>.
@prefix log: <http://www.w3.org/2000/10/swap/log#>.
@prefix : <urn:example:>.

# components
:zeroKnowledgeProof a log:Component.
:challengeProof a log:Component.

# private person data
:Mary :birthDay "2000-01-01"^^xsd:date.
:Pat :birthDay "1970-01-01"^^xsd:date.
:John :birthDay "1960-01-01"^^xsd:date.

# simulation date
:simulation1 :date "2025-01-11T00:00:00.0Z"^^xsd:dateTime.

# simulation age
:simulation1 :age "P50Y"^^xsd:duration.

# prover proving that someone is above some age using a hash and without revealing their age
(   _:Name
    _:Result
    _:Hash
    _:BirthDay
    _:Date
    _:Age
    _:Diff
    _:Str
    _:Context
) log:onNegativeSurface {
    () log:onNegativeSurface {
        :simulation1 :zeroKnowledgeProof (_:Name _:Result _:Hash).
    }.
    _:Name :birthDay _:BirthDay.
    :simulation1 :date _:Date.
    :simulation1 :age _:Age.
    (_:Date _:BirthDay) math:difference _:Diff.
    ({ _:Diff math:greaterThan _:Age }) string:concatenation _:Str.
    _:Str crypto:sha256 _:Hash.
    (
        { _:Diff math:greaterThan _:Age }
        { _:Result log:equalTo ("proof verified: " _:Name " is more than 50 years old and entitled to work 80% per week")!string:concatenation }
        { _:Result log:equalTo ("proof failed: " _:Name " is less than 50 years and not entitled to work 80% per week")!string:concatenation }
    ) log:ifThenElseIn (_:Context -1).
}.

# challenging the proof using the hash
(   _:Name
    _:Result
    _:Hash
    _:BirthDay
    _:Date
    _:Age
    _:Diff
    _:Str
    _:ProofHash
    _:Context
) log:onNegativeSurface {
    () log:onNegativeSurface {
        :simulation1 :challengeProof (_:Name _:Result _:Hash).
    }.
    _:Name :birthDay _:BirthDay.
    :simulation1 :date _:Date.
    :simulation1 :age _:Age.
    (_:Date _:BirthDay) math:difference _:Diff.
    ({ _:Diff math:greaterThan _:Age }) string:concatenation _:Str.
    _:Str crypto:sha256 _:ProofHash.
    (
        { _:Hash log:equalTo _:ProofHash }
        { _:Result log:equalTo ("challenge successful: the proof is valid")!string:concatenation }
        { _:Result log:equalTo ("challenge failed: the proof is invalid")!string:concatenation }
    ) log:ifThenElseIn (_:Context -1).
}.

# query
() log:onNegativeSurface {
    :simulation1 :zeroKnowledgeProof (:Mary "proof failed: :Mary is less than 50 years and not entitled to work 80% per week" "4f1aa645fc353e36d9fbb3b78d34b97ab34cc1b515dc80276e66ea11acfe2c96").
    :simulation1 :zeroKnowledgeProof (:Pat "proof verified: :Pat is more than 50 years old and entitled to work 80% per week" "5611fb0dfa67e894917f81cf4b24577e4bc89c86c17423ba7fc28181eb368b3b").
    :simulation1 :challengeProof (:Mary "challenge failed: the proof is invalid" "adf23913cd97b2d831b54cf9109c111d205d8dfd777413235bdb1c7c91cf4007").
    :simulation1 :challengeProof (:Pat "challenge successful: the proof is valid" "5611fb0dfa67e894917f81cf4b24577e4bc89c86c17423ba7fc28181eb368b3b").
    () log:onNegativeAnswerSurface {
        :test :is true .
    } .
} .
